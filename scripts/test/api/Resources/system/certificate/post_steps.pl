# --
# Copyright (C) 2006-2025 KIX Service Software GmbH, https://www.kixdesk.com
# --
# This software comes with ABSOLUTELY NO WARRANTY. For details, see
# the enclosed file LICENSE-AGPL for license information (AGPL). If you
# did not receive this file, see https://www.gnu.org/licenses/agpl.txt.
# --
use warnings;

use Cwd;
use lib cwd();
use lib cwd() . '/Kernel/cpan-lib';
use lib cwd() . '/plugins';
use lib cwd() . '/scripts/test/api/Cucumber';

use LWP::UserAgent;
use HTTP::Request;
use JSON::MaybeXS qw(encode_json decode_json);
use JSON::Validator;

use Test::More;
use Test::BDD::Cucumber::StepFile;

use Data::Dumper;

use Kernel::System::ObjectManager;

$Kernel::OM = Kernel::System::ObjectManager->new();

# require our helper
require '_Helper.pl';

# require our common library
require '_StepsLib.pl';

# feature specific steps 

Given qr/a certificate$/, sub {

   ( S->{Response}, S->{ResponseContent} ) = _Post(
      URL     => S->{API_URL}.'/system/certificates',
      Token   => S->{Token},
      Content => {
		  Certificate => {
              File => {
                  Content => "Q2VydGlmaWNhdGU6CiAgICBEYXRhOgogICAgICAgIFZlcnNpb246IDMgKDB4MikKICAgICAgICBTZXJpYWwgTnVtYmVyOiA3MjMgKDB4MmQzKQogICAgICAgIFNpZ25hdHVyZSBBbGdvcml0aG06IHNoYTI1NldpdGhSU0FFbmNyeXB0aW9uCiAgICAgICAgSXNzdWVyOiBDPURFLCBTVD1ERSwgTD1ERSwgTz1ERSwgT1U9VW5pdmVudGlvbiBDb3Jwb3JhdGUgU2VydmVyLCBDTj1Vbml2ZW50aW9uIENvcnBvcmF0ZSBTZXJ2ZXIgUm9vdCBDQSAoSUQ9cVdvWFQyU2cpL2VtYWlsQWRkcmVzcz1hZG1pbkBjYXBlLWl0LmRlCiAgICAgICAgVmFsaWRpdHkKICAgICAgICAgICAgTm90IEJlZm9yZTogSmFuICAyIDExOjA5OjQ1IDIwMjMgR01UCiAgICAgICAgICAgIE5vdCBBZnRlciA6IEphbiAgMSAxMTowOTo0NSAyMDI4IEdNVAogICAgICAgIFN1YmplY3Q6IEM9REUsIFNUPURFLCBMPURFLCBPPURFLCBPVT1Vbml2ZW50aW9uIENvcnBvcmF0ZSBTZXJ2ZXIsIENOPWZqYWNxdWVtaW4ub3BlbnZwbi9lbWFpbEFkZHJlc3M9YWRtaW5AY2FwZS1pdC5kZQogICAgICAgIFN1YmplY3QgUHVibGljIEtleSBJbmZvOgogICAgICAgICAgICBQdWJsaWMgS2V5IEFsZ29yaXRobTogcnNhRW5jcnlwdGlvbgogICAgICAgICAgICAgICAgUlNBIFB1YmxpYy1LZXk6ICgyMDQ4IGJpdCkKICAgICAgICAgICAgICAgIE1vZHVsdXM6CiAgICAgICAgICAgICAgICAgICAgMDA6ZjU6NmM6MzE6YTY6ZDU6ZjI6Y2Q6YTg6OGU6YjQ6YzI6YmM6Njk6MGM6CiAgICAgICAgICAgICAgICAgICAgZjU6MjA6ZmE6MTQ6MzE6NTY6MTA6M2E6OGE6Njc6MjA6YTY6ZjI6YzQ6OTE6CiAgICAgICAgICAgICAgICAgICAgZjQ6YmQ6YTY6Y2Q6ZDc6NmE6NDI6M2U6NDc6NGU6ZTE6YWU6MjQ6MDU6NDk6CiAgICAgICAgICAgICAgICAgICAgYjk6NTc6MGY6OWY6YjU6NGI6NGQ6OTA6OGE6Mzk6Zjg6YmU6M2I6MWI6ZTE6CiAgICAgICAgICAgICAgICAgICAgNzY6MTE6MTc6MGE6MzQ6OGY6Y2Y6MGY6ZWM6OGQ6Y2M6MTI6ODA6NWY6N2Q6CiAgICAgICAgICAgICAgICAgICAgMTg6NmQ6OGM6MTI6ZjE6Mjc6ZTU6Y2I6NDU6MDA6NDU6N2Q6NmI6YjU6Yjc6CiAgICAgICAgICAgICAgICAgICAgM2Y6MTM6ZDc6NTg6NzY6MjY6N2U6YmI6Y2Q6NDY6MGQ6YjI6NmM6MTI6ZDY6CiAgICAgICAgICAgICAgICAgICAgY2Q6YmQ6ODI6NDg6YzM6ZmU6YmI6MDQ6NjQ6ZWU6NGM6NWM6Mjk6M2E6OTA6CiAgICAgICAgICAgICAgICAgICAgOTY6NTQ6Y2E6NmU6Yzg6MDY6M2I6NzA6Yjg6ZGM6ZmM6Mzk6MmU6YTY6OWQ6CiAgICAgICAgICAgICAgICAgICAgNWQ6NWI6NmY6NjA6NjQ6MTg6Mzk6N2Q6NDM6Nzc6YmM6YWQ6NjM6YzE6YjU6CiAgICAgICAgICAgICAgICAgICAgNjQ6YmI6NDc6NjM6MjY6MzU6OTQ6ODI6OTY6ZjY6M2I6MDY6NzM6YTQ6Yjg6CiAgICAgICAgICAgICAgICAgICAgNTU6MGU6NDU6ZjI6YmU6MDc6NmI6ODE6MDM6NmQ6NDU6ODE6Mjg6Mzc6ZTY6CiAgICAgICAgICAgICAgICAgICAgNGE6NjM6N2Y6NmI6NzQ6MmM6ZGE6ZjA6ODc6ZWU6MGE6ZDI6NzE6NTU6M2Y6CiAgICAgICAgICAgICAgICAgICAgOGQ6OWE6ZTc6MjQ6ZWY6YWY6ODE6MmE6YjE6OGM6N2M6N2Y6NTQ6NTA6ZjI6CiAgICAgICAgICAgICAgICAgICAgMjQ6Zjg6MjA6ZGU6NDA6Y2I6NTk6MjM6M2U6ZjQ6NTQ6OWM6NDE6ODM6OGM6CiAgICAgICAgICAgICAgICAgICAgNDQ6Yjg6MTk6OWM6NWY6YzU6Mzc6ZjY6YWQ6MDI6NGE6M2E6ZTk6OTE6NDU6CiAgICAgICAgICAgICAgICAgICAgNWE6OGU6NDA6MWY6OWQ6NDg6MGQ6NTM6ZWQ6NzE6ZWY6Yjg6Zjc6M2I6NGM6CiAgICAgICAgICAgICAgICAgICAgMGU6MzEKICAgICAgICAgICAgICAgIEV4cG9uZW50OiA2NTUzNyAoMHgxMDAwMSkKICAgICAgICBYNTA5djMgZXh0ZW5zaW9uczoKICAgICAgICAgICAgWDUwOXYzIEJhc2ljIENvbnN0cmFpbnRzOiAKICAgICAgICAgICAgICAgIENBOkZBTFNFCiAgICAgICAgICAgIFg1MDl2MyBTdWJqZWN0IEtleSBJZGVudGlmaWVyOiAKICAgICAgICAgICAgICAgIDU3OjhEOjZDOkU5OkE1OjgyOkIxOjI4OkEwOjU0Ojk1OjdDOjAyOjA1OjQwOjlFOkZFOjdDOkIwOjEwCiAgICAgICAgICAgIFg1MDl2MyBBdXRob3JpdHkgS2V5IElkZW50aWZpZXI6IAogICAgICAgICAgICAgICAga2V5aWQ6Njg6MTE6NDY6Mjc6NjY6OTI6M0Y6NEM6MUE6ODY6ODQ6MTU6OEU6RTE6MTE6OTA6Mjg6RTU6MEU6QjUKICAgICAgICAgICAgICAgIERpck5hbWU6L0M9REUvU1Q9REUvTD1ERS9PPURFL09VPVVuaXZlbnRpb24gQ29ycG9yYXRlIFNlcnZlci9DTj1Vbml2ZW50aW9uIENvcnBvcmF0ZSBTZXJ2ZXIgUm9vdCBDQSAoSUQ9cVdvWFQyU2cpL2VtYWlsQWRkcmVzcz1hZG1pbkBjYXBlLWl0LmRlCiAgICAgICAgICAgICAgICBzZXJpYWw6QjI6RDA6QjI6RTU6MDg6N0Y6RkQ6MDMKCiAgICAgICAgICAgIFg1MDl2MyBLZXkgVXNhZ2U6IAogICAgICAgICAgICAgICAgRGlnaXRhbCBTaWduYXR1cmUsIE5vbiBSZXB1ZGlhdGlvbiwgS2V5IEVuY2lwaGVybWVudAogICAgU2lnbmF0dXJlIEFsZ29yaXRobTogc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24KICAgICAgICAgNmE6NzQ6ZjU6ZTY6NWY6NTQ6OWI6MDk6MjU6YzA6N2Q6YmM6MGQ6MTg6MjM6OGU6NWI6ZmM6CiAgICAgICAgIDE1OjJmOjk3OjdjOjU3OjRlOjgwOmIzOjAzOjI4OjI0OjUzOmZkOjhiOjVlOmZhOjFkOjhlOgogICAgICAgICA4MzozNjo2OTpmZDo1YTo3ODo4OToyNTpmMzpjZDpmNzoxYzpiODpkYzpjYTo2ZDo4YzoxZDoKICAgICAgICAgN2U6Yjg6M2E6MjM6N2M6ZTA6OWU6NDg6ZTI6NDc6NWQ6YjU6NDA6OGU6YjQ6Yzg6YmU6ZGE6CiAgICAgICAgIGQxOmFmOmFhOjRjOjRkOjUxOmUxOjFhOmRiOjVmOjQ5OmM5OmZjOmU1OmNlOmY3OjBiOmU0OgogICAgICAgICBiZjowZTphNjo1Yjo5ODpiZjowMTo3MDplNDo4NzpkNjo5NTo0MDowOToxZTpiYjpmMzpiZToKICAgICAgICAgMDI6NmM6OWE6NTc6ZGI6MGI6YTE6ZDU6NDA6MmY6ZTI6NTE6MTg6YmM6MmI6NTc6NDI6OWY6CiAgICAgICAgIDc4OjI2OjRkOmQ5OjQ4OmZlOjM5OjI0OjhjOjI4OjVjOjQzOmNlOjA4OmY0OjQyOjQ0OmVhOgogICAgICAgICBjYjozNTo5ZTplMzpjNjoxMToyZjpiOTpmYTozZjpmNTo5YzpkZjozMTo4YjozNzo0ZTpiMToKICAgICAgICAgZGI6M2I6Mjc6NGI6MWY6Y2I6NzU6ZDc6YWI6MmM6NTg6MmI6OTY6YmU6N2Y6ZTA6NDU6YjA6CiAgICAgICAgIDBiOjBjOmRlOjNiOjllOjMyOjEyOjM2OjJkOjBlOjAzOjEzOjI3Ojk2OjNmOmI4OmQ4OmU4OgogICAgICAgICA5OTo2ZDoxMTowMjo4YjplNjo2NDoyMjpmMTpjYzo3NzowMTo3MzowNDpiZDphMToxNzo3NjoKICAgICAgICAgOTA6NDQ6YTI6N2E6MTQ6YzU6MGU6MTg6YWU6NTc6Y2U6OTk6MDY6YmM6NDE6ZDE6Njg6MGQ6CiAgICAgICAgIDM1OmI4Ojk3OmYzOjAxOmZhOjQ5Ojk3OjNmOmExOjM0OmI2OmM3Ojg5OjFjOjIwOjljOmUxOgogICAgICAgICBjZDpjNzo3YjozNwotLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KTUlJRStUQ0NBK0dnQXdJQkFnSUNBdE13RFFZSktvWklodmNOQVFFTEJRQXdnYmN4Q3pBSkJnTlZCQVlUQWtSRgpNUXN3Q1FZRFZRUUlFd0pFUlRFTE1Ba0dBMVVFQnhNQ1JFVXhDekFKQmdOVkJBb1RBa1JGTVNRd0lnWURWUVFMCkV4dFZibWwyWlc1MGFXOXVJRU52Y25CdmNtRjBaU0JUWlhKMlpYSXhPakE0QmdOVkJBTVRNVlZ1YVhabGJuUnAKYjI0Z1EyOXljRzl5WVhSbElGTmxjblpsY2lCU2IyOTBJRU5CSUNoSlJEMXhWMjlZVkRKVFp5a3hIekFkQmdrcQpoa2lHOXcwQkNRRVdFR0ZrYldsdVFHTmhjR1V0YVhRdVpHVXdIaGNOTWpNd01UQXlNVEV3T1RRMVdoY05Namd3Ck1UQXhNVEV3T1RRMVdqQ0JtREVMTUFrR0ExVUVCaE1DUkVVeEN6QUpCZ05WQkFnVEFrUkZNUXN3Q1FZRFZRUUgKRXdKRVJURUxNQWtHQTFVRUNoTUNSRVV4SkRBaUJnTlZCQXNURzFWdWFYWmxiblJwYjI0Z1EyOXljRzl5WVhSbApJRk5sY25abGNqRWJNQmtHQTFVRUF4TVNabXBoWTNGMVpXMXBiaTV2Y0dWdWRuQnVNUjh3SFFZSktvWklodmNOCkFRa0JGaEJoWkcxcGJrQmpZWEJsTFdsMExtUmxNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUIKQ2dLQ0FRRUE5V3d4cHRYeXphaU90TUs4YVF6MUlQb1VNVllRT29wbklLYnl4SkgwdmFiTjEycENQa2RPNGE0awpCVW01VncrZnRVdE5rSW81K0w0N0crRjJFUmNLTkkvUEQreU56QktBWDMwWWJZd1M4U2ZseTBVQVJYMXJ0YmMvCkU5ZFlkaVordTgxR0RiSnNFdGJOdllKSXcvNjdCR1R1VEZ3cE9wQ1dWTXB1eUFZN2NMamMvRGt1cHAxZFcyOWcKWkJnNWZVTjN2SzFqd2JWa3UwZGpKaldVZ3BiMk93WnpwTGhWRGtYeXZnZHJnUU50UllFb04rWktZMzlyZEN6YQo4SWZ1Q3RKeFZUK05tdWNrNzYrQktyR01mSDlVVVBJaytDRGVRTXRaSXo3MFZKeEJnNHhFdUJtY1g4VTM5cTBDClNqcnBrVVZhamtBZm5VZ05VKzF4NzdqM08wd09NUUlEQVFBQm80SUJLakNDQVNZd0NRWURWUjBUQkFJd0FEQWQKQmdOVkhRNEVGZ1FVVjQxczZhV0NzU2lnVkpWOEFnVkFudjU4c0JBd2dld0dBMVVkSXdTQjVEQ0I0WUFVYUJGRwpKMmFTUDB3YWhvUVZqdUVSa0NqbERyV2hnYjJrZ2Jvd2diY3hDekFKQmdOVkJBWVRBa1JGTVFzd0NRWURWUVFJCkV3SkVSVEVMTUFrR0ExVUVCeE1DUkVVeEN6QUpCZ05WQkFvVEFrUkZNU1F3SWdZRFZRUUxFeHRWYm1sMlpXNTAKYVc5dUlFTnZjbkJ2Y21GMFpTQlRaWEoyWlhJeE9qQTRCZ05WQkFNVE1WVnVhWFpsYm5ScGIyNGdRMjl5Y0c5eQpZWFJsSUZObGNuWmxjaUJTYjI5MElFTkJJQ2hKUkQxeFYyOVlWREpUWnlreEh6QWRCZ2txaGtpRzl3MEJDUUVXCkVHRmtiV2x1UUdOaGNHVXRhWFF1WkdXQ0NRQ3kwTExsQ0gvOUF6QUxCZ05WSFE4RUJBTUNCZUF3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFHcDA5ZVpmVkpzSkpjQjl2QTBZSTQ1Yi9CVXZsM3hYVG9DekF5Z2tVLzJMWHZvZApqb00yYWYxYWVJa2w4ODMzSExqY3ltMk1IWDY0T2lOODRKNUk0a2RkdFVDT3RNaSsydEd2cWt4TlVlRWEyMTlKCnlmemx6dmNMNUw4T3BsdVl2d0Z3NUlmV2xVQUpIcnZ6dmdKc21sZmJDNkhWUUMvaVVSaThLMWRDbjNnbVRkbEkKL2pra2pDaGNRODRJOUVKRTZzczFudVBHRVMrNStqLzFuTjh4aXpkT3NkczdKMHNmeTNYWHF5eFlLNWErZitCRgpzQXNNM2p1ZU1oSTJMUTRERXllV1A3alk2Smx0RVFLTDVtUWk4Y3gzQVhNRXZhRVhkcEJFb25vVXhRNFlybGZPCm1RYThRZEZvRFRXNGwvTUIra21YUDZFMHRzZUpIQ0NjNGMzSGV6Yz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=",
                  ContentType => "application/x-x509-ca-cert",
                  Filename => "cert.pem",
                  Filesize => "5.1 KBytes",
                  FilesizeRaw => 5270
              },
              Type => "Cert"
		  }
	  }
   );
};

When qr/I create a certificate$/, sub {

   ( S->{Response}, S->{ResponseContent} ) = _Post(
      URL     => S->{API_URL}.'/system/certificates',
      Token   => S->{Token},
	   Content => {
		   Certificate => {
			   File => {
				   Content => "LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUY4VENDQTltZ0F3SUJBZ0lVQzVSRXBrWk80MnJFdHJyTkgzKzhlR0tWK3dVd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2dZY3hDekFKQmdOVkJBWVRBa1JGTVE4d0RRWURWUVFJREFaVFlYaHZibmt4RVRBUEJnTlZCQWNNQ0VObwpaVzF1YVhSNk1Sa3dGd1lEVlFRS0RCQmpMbUV1Y0M1bExpQkpWQ0JIYldKSU1STXdFUVlEVlFRRERBcHpaV3htCmMybG5ibVZrTVNRd0lnWUpLb1pJaHZjTkFRa0JGaFZ6Wld4bWMybG5ibVZrUUdOaGNHVXRhWFF1WkdVd0hoY04KTWpBd05qQXpNVFEwTVRNMFdoY05NekF3TmpBeE1UUTBNVE0wV2pDQmh6RUxNQWtHQTFVRUJoTUNSRVV4RHpBTgpCZ05WQkFnTUJsTmhlRzl1ZVRFUk1BOEdBMVVFQnd3SVEyaGxiVzVwZEhveEdUQVhCZ05WQkFvTUVHTXVZUzV3CkxtVXVJRWxVSUVkdFlrZ3hFekFSQmdOVkJBTU1Dbk5sYkdaemFXZHVaV1F4SkRBaUJna3Foa2lHOXcwQkNRRVcKRlhObGJHWnphV2R1WldSQVkyRndaUzFwZEM1a1pUQ0NBaUl3RFFZSktvWklodmNOQVFFQkJRQURnZ0lQQURDQwpBZ29DZ2dJQkFKczRQV3BKR0hrMklVdlRxdlZma3pTcWxMUXVacnBqQWhXVThGYXhua2JTSGIvcGhvd2xyUlRHCmVEYm9KSmZjNWJIM3k0eno4bE9JTkNqdUVGNUVmS04yVzlUUmN2dGE4c09qcGFhMC9jb1N0ZXpKYlhKait6QTgKU04yT1BVVTFYVE5vaGRnZkQyR004TmF6ZEl4K2RyV2MxSnBxemY2YlRhM0dXN0VFWFlBbjFCYlFOU0RYK01zVQowRjEyMHQ3S00wZ1JwWFI4dGNsakt2MnYrNFo5T3B0aGQxM0l2T05qS3NqbTRrZkgrTHJLeXVmbThiZEZ5UDBCCk10K0NOZ2ZWUm9vVmhFdkxaRE9KeFFzaFhXSzR3YkRidVBUN0psN1JlUEFCVWhKSlNpUXhKS2FmVUE5eTl0N3YKQ3N4L3N4bHVMZTE3MTJwcmREK0xkQU1hZkQ3Nk9aRkNGQkg2UXErK2lyNEdJWUM2ckE2ZmZQRG1XbzFJRGFGNwoyQUNUWHppbEVOOThoNE9MQVVvVFRmUTNIWXc4cExLcWsyYy9Qa1pwamRzZEs2OXBIN0RHaVpMWmIwOGZnNkZOCmU1QUd0Z25oWDhYWHRvdTMreGlWUno0enJ6b1JQc2hkUTVBbVpsb25ma3FwZkFoQURLclRaVFBHTldWbkIzZlMKL1hmWUpBaWQ1MGFGSVhJMm9OckF1UVp2d25TNUNwK05uelY5ajZDT0VLUExPQk9ZZ2RpRDMvcmV0cnltZUhWeApWVE0vdWNtblVqbUczcUpUbk42Q0NlaUNCSURSNVdPRk16Y2drVXZ0ZDczQmNIMDBVK250Sk5XNnFCOEc3NkQxClVjZlZqUzNHdjFuWGpTSXNJOVc4V0RLRVVWS0d0STNWRWc3M2JlSzJ4L0NOb2FsS2FubGJBZ01CQUFHalV6QlIKTUIwR0ExVWREZ1FXQkJTUkVYNEJTQjl3WU51U3JySHhlUjhRbWFmMDdEQWZCZ05WSFNNRUdEQVdnQlNSRVg0QgpTQjl3WU51U3JySHhlUjhRbWFmMDdEQVBCZ05WSFJNQkFmOEVCVEFEQVFIL01BMEdDU3FHU0liM0RRRUJDd1VBCkE0SUNBUUE2TkxjdG9TajA4enlMTUFpeXZsZUJDVHR5Mkk1ZVE4STlWZkpuYnBHendLb1A0d3NnbUZHMnlDZlAKbVByWXVyN0xQclNRZWV5MXpCMWlWY2YzZmRtNkZQay8wdHhUT043YmgrODE0c1ZyZHNrMlJ0R2xacjYydXdTZwplL3E1c3BBUVkwdERoZXpLZGVJQitSYlNISUpySG1GTU5tazgrM0UvVHAwRlk4L1Q0WFBKT0FXcWpKQVhIY1BTClNhZ2kzbjNLeWl3UmFNSWpycjN6T0N5b1hSYU8vYm11aDZjUENqTUhCQTFJeXlKbmtPUzhHT1U1ZFY2VlJhUXEKb2hnWVY2SjlMY2xYbytrejVUVVV4RDh2ejhOZGJpQWtoTmFFQzFuZURDRThlNE1CdUNLZmNhY3gxR09lTkVFNgpkcU02dHFUMUUrbkt5Wm13QUdQWU5tOWdRMVg4cjA0QkJNeUxCR0EyYndEc3BVK1A5VE1SS256UTYybHZxNmRmCmpnSllBd1NKaHhaMXVsYVUyRVhGUi80NXZkSXR3bjhMU0krdlVpQkhrM0I2YVdOMEFkUWNoTWtFVFVEUTJ0OWEKd1ZsMGs0SmRqLzR2bjdkcFVmb2ZqVkdlZEE2Q0FFbnJjSnZ0L3NLUXZLMDJFNTFYMjhoc3NkM2dobDFpN2lSQQpkOFNMSSsrUm5vYkxYelZZczhJTTFuRmFBMXJNTUtnbDUwbkNyOUlFdnZLSkZxaFQ2aXkxYjd1RGVTU290cHlECmZMWUQzWVF0UDdaMDB4UzFONm81aFpIb01pQ1QyNnkyYTIwSXF2NlhoeGx4UzNNWDBRUkg0Y1FlbGNxeFVCUkMKNDFHYmxjVk10TE51WkNTYnFYb1BxZ0I0ODUxdG5JeGRFUUNoeXM1a2V0N1YyaDFUOEE9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==",
				   ContentType => "application/x-x509-ca-cert",
				   Filename => "Certificate-791510e5.pem",
				   Filesize => "2.1 KBytes",
				   FilesizeRaw => 2122
			   },
			   Type => "Cert"
		   }
	   }
   );
};

When qr/I create a second certificate$/, sub {

	( S->{Response}, S->{ResponseContent} ) = _Post(
		URL     => S->{API_URL}.'/system/certificates',
		Token   => S->{Token},
		Content => {
			Certificate => {
				File => {
					Content => "Q2VydGlmaWNhdGU6CiAgICBEYXRhOgogICAgICAgIFZlcnNpb246IDMgKDB4MikKICAgICAgICBTZXJpYWwgTnVtYmVyOiA3MjMgKDB4MmQzKQogICAgICAgIFNpZ25hdHVyZSBBbGdvcml0aG06IHNoYTI1NldpdGhSU0FFbmNyeXB0aW9uCiAgICAgICAgSXNzdWVyOiBDPURFLCBTVD1ERSwgTD1ERSwgTz1ERSwgT1U9VW5pdmVudGlvbiBDb3Jwb3JhdGUgU2VydmVyLCBDTj1Vbml2ZW50aW9uIENvcnBvcmF0ZSBTZXJ2ZXIgUm9vdCBDQSAoSUQ9cVdvWFQyU2cpL2VtYWlsQWRkcmVzcz1hZG1pbkBjYXBlLWl0LmRlCiAgICAgICAgVmFsaWRpdHkKICAgICAgICAgICAgTm90IEJlZm9yZTogSmFuICAyIDExOjA5OjQ1IDIwMjMgR01UCiAgICAgICAgICAgIE5vdCBBZnRlciA6IEphbiAgMSAxMTowOTo0NSAyMDI4IEdNVAogICAgICAgIFN1YmplY3Q6IEM9REUsIFNUPURFLCBMPURFLCBPPURFLCBPVT1Vbml2ZW50aW9uIENvcnBvcmF0ZSBTZXJ2ZXIsIENOPWZqYWNxdWVtaW4ub3BlbnZwbi9lbWFpbEFkZHJlc3M9YWRtaW5AY2FwZS1pdC5kZQogICAgICAgIFN1YmplY3QgUHVibGljIEtleSBJbmZvOgogICAgICAgICAgICBQdWJsaWMgS2V5IEFsZ29yaXRobTogcnNhRW5jcnlwdGlvbgogICAgICAgICAgICAgICAgUlNBIFB1YmxpYy1LZXk6ICgyMDQ4IGJpdCkKICAgICAgICAgICAgICAgIE1vZHVsdXM6CiAgICAgICAgICAgICAgICAgICAgMDA6ZjU6NmM6MzE6YTY6ZDU6ZjI6Y2Q6YTg6OGU6YjQ6YzI6YmM6Njk6MGM6CiAgICAgICAgICAgICAgICAgICAgZjU6MjA6ZmE6MTQ6MzE6NTY6MTA6M2E6OGE6Njc6MjA6YTY6ZjI6YzQ6OTE6CiAgICAgICAgICAgICAgICAgICAgZjQ6YmQ6YTY6Y2Q6ZDc6NmE6NDI6M2U6NDc6NGU6ZTE6YWU6MjQ6MDU6NDk6CiAgICAgICAgICAgICAgICAgICAgYjk6NTc6MGY6OWY6YjU6NGI6NGQ6OTA6OGE6Mzk6Zjg6YmU6M2I6MWI6ZTE6CiAgICAgICAgICAgICAgICAgICAgNzY6MTE6MTc6MGE6MzQ6OGY6Y2Y6MGY6ZWM6OGQ6Y2M6MTI6ODA6NWY6N2Q6CiAgICAgICAgICAgICAgICAgICAgMTg6NmQ6OGM6MTI6ZjE6Mjc6ZTU6Y2I6NDU6MDA6NDU6N2Q6NmI6YjU6Yjc6CiAgICAgICAgICAgICAgICAgICAgM2Y6MTM6ZDc6NTg6NzY6MjY6N2U6YmI6Y2Q6NDY6MGQ6YjI6NmM6MTI6ZDY6CiAgICAgICAgICAgICAgICAgICAgY2Q6YmQ6ODI6NDg6YzM6ZmU6YmI6MDQ6NjQ6ZWU6NGM6NWM6Mjk6M2E6OTA6CiAgICAgICAgICAgICAgICAgICAgOTY6NTQ6Y2E6NmU6Yzg6MDY6M2I6NzA6Yjg6ZGM6ZmM6Mzk6MmU6YTY6OWQ6CiAgICAgICAgICAgICAgICAgICAgNWQ6NWI6NmY6NjA6NjQ6MTg6Mzk6N2Q6NDM6Nzc6YmM6YWQ6NjM6YzE6YjU6CiAgICAgICAgICAgICAgICAgICAgNjQ6YmI6NDc6NjM6MjY6MzU6OTQ6ODI6OTY6ZjY6M2I6MDY6NzM6YTQ6Yjg6CiAgICAgICAgICAgICAgICAgICAgNTU6MGU6NDU6ZjI6YmU6MDc6NmI6ODE6MDM6NmQ6NDU6ODE6Mjg6Mzc6ZTY6CiAgICAgICAgICAgICAgICAgICAgNGE6NjM6N2Y6NmI6NzQ6MmM6ZGE6ZjA6ODc6ZWU6MGE6ZDI6NzE6NTU6M2Y6CiAgICAgICAgICAgICAgICAgICAgOGQ6OWE6ZTc6MjQ6ZWY6YWY6ODE6MmE6YjE6OGM6N2M6N2Y6NTQ6NTA6ZjI6CiAgICAgICAgICAgICAgICAgICAgMjQ6Zjg6MjA6ZGU6NDA6Y2I6NTk6MjM6M2U6ZjQ6NTQ6OWM6NDE6ODM6OGM6CiAgICAgICAgICAgICAgICAgICAgNDQ6Yjg6MTk6OWM6NWY6YzU6Mzc6ZjY6YWQ6MDI6NGE6M2E6ZTk6OTE6NDU6CiAgICAgICAgICAgICAgICAgICAgNWE6OGU6NDA6MWY6OWQ6NDg6MGQ6NTM6ZWQ6NzE6ZWY6Yjg6Zjc6M2I6NGM6CiAgICAgICAgICAgICAgICAgICAgMGU6MzEKICAgICAgICAgICAgICAgIEV4cG9uZW50OiA2NTUzNyAoMHgxMDAwMSkKICAgICAgICBYNTA5djMgZXh0ZW5zaW9uczoKICAgICAgICAgICAgWDUwOXYzIEJhc2ljIENvbnN0cmFpbnRzOiAKICAgICAgICAgICAgICAgIENBOkZBTFNFCiAgICAgICAgICAgIFg1MDl2MyBTdWJqZWN0IEtleSBJZGVudGlmaWVyOiAKICAgICAgICAgICAgICAgIDU3OjhEOjZDOkU5OkE1OjgyOkIxOjI4OkEwOjU0Ojk1OjdDOjAyOjA1OjQwOjlFOkZFOjdDOkIwOjEwCiAgICAgICAgICAgIFg1MDl2MyBBdXRob3JpdHkgS2V5IElkZW50aWZpZXI6IAogICAgICAgICAgICAgICAga2V5aWQ6Njg6MTE6NDY6Mjc6NjY6OTI6M0Y6NEM6MUE6ODY6ODQ6MTU6OEU6RTE6MTE6OTA6Mjg6RTU6MEU6QjUKICAgICAgICAgICAgICAgIERpck5hbWU6L0M9REUvU1Q9REUvTD1ERS9PPURFL09VPVVuaXZlbnRpb24gQ29ycG9yYXRlIFNlcnZlci9DTj1Vbml2ZW50aW9uIENvcnBvcmF0ZSBTZXJ2ZXIgUm9vdCBDQSAoSUQ9cVdvWFQyU2cpL2VtYWlsQWRkcmVzcz1hZG1pbkBjYXBlLWl0LmRlCiAgICAgICAgICAgICAgICBzZXJpYWw6QjI6RDA6QjI6RTU6MDg6N0Y6RkQ6MDMKCiAgICAgICAgICAgIFg1MDl2MyBLZXkgVXNhZ2U6IAogICAgICAgICAgICAgICAgRGlnaXRhbCBTaWduYXR1cmUsIE5vbiBSZXB1ZGlhdGlvbiwgS2V5IEVuY2lwaGVybWVudAogICAgU2lnbmF0dXJlIEFsZ29yaXRobTogc2hhMjU2V2l0aFJTQUVuY3J5cHRpb24KICAgICAgICAgNmE6NzQ6ZjU6ZTY6NWY6NTQ6OWI6MDk6MjU6YzA6N2Q6YmM6MGQ6MTg6MjM6OGU6NWI6ZmM6CiAgICAgICAgIDE1OjJmOjk3OjdjOjU3OjRlOjgwOmIzOjAzOjI4OjI0OjUzOmZkOjhiOjVlOmZhOjFkOjhlOgogICAgICAgICA4MzozNjo2OTpmZDo1YTo3ODo4OToyNTpmMzpjZDpmNzoxYzpiODpkYzpjYTo2ZDo4YzoxZDoKICAgICAgICAgN2U6Yjg6M2E6MjM6N2M6ZTA6OWU6NDg6ZTI6NDc6NWQ6YjU6NDA6OGU6YjQ6Yzg6YmU6ZGE6CiAgICAgICAgIGQxOmFmOmFhOjRjOjRkOjUxOmUxOjFhOmRiOjVmOjQ5OmM5OmZjOmU1OmNlOmY3OjBiOmU0OgogICAgICAgICBiZjowZTphNjo1Yjo5ODpiZjowMTo3MDplNDo4NzpkNjo5NTo0MDowOToxZTpiYjpmMzpiZToKICAgICAgICAgMDI6NmM6OWE6NTc6ZGI6MGI6YTE6ZDU6NDA6MmY6ZTI6NTE6MTg6YmM6MmI6NTc6NDI6OWY6CiAgICAgICAgIDc4OjI2OjRkOmQ5OjQ4OmZlOjM5OjI0OjhjOjI4OjVjOjQzOmNlOjA4OmY0OjQyOjQ0OmVhOgogICAgICAgICBjYjozNTo5ZTplMzpjNjoxMToyZjpiOTpmYTozZjpmNTo5YzpkZjozMTo4YjozNzo0ZTpiMToKICAgICAgICAgZGI6M2I6Mjc6NGI6MWY6Y2I6NzU6ZDc6YWI6MmM6NTg6MmI6OTY6YmU6N2Y6ZTA6NDU6YjA6CiAgICAgICAgIDBiOjBjOmRlOjNiOjllOjMyOjEyOjM2OjJkOjBlOjAzOjEzOjI3Ojk2OjNmOmI4OmQ4OmU4OgogICAgICAgICA5OTo2ZDoxMTowMjo4YjplNjo2NDoyMjpmMTpjYzo3NzowMTo3MzowNDpiZDphMToxNzo3NjoKICAgICAgICAgOTA6NDQ6YTI6N2E6MTQ6YzU6MGU6MTg6YWU6NTc6Y2U6OTk6MDY6YmM6NDE6ZDE6Njg6MGQ6CiAgICAgICAgIDM1OmI4Ojk3OmYzOjAxOmZhOjQ5Ojk3OjNmOmExOjM0OmI2OmM3Ojg5OjFjOjIwOjljOmUxOgogICAgICAgICBjZDpjNzo3YjozNwotLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KTUlJRStUQ0NBK0dnQXdJQkFnSUNBdE13RFFZSktvWklodmNOQVFFTEJRQXdnYmN4Q3pBSkJnTlZCQVlUQWtSRgpNUXN3Q1FZRFZRUUlFd0pFUlRFTE1Ba0dBMVVFQnhNQ1JFVXhDekFKQmdOVkJBb1RBa1JGTVNRd0lnWURWUVFMCkV4dFZibWwyWlc1MGFXOXVJRU52Y25CdmNtRjBaU0JUWlhKMlpYSXhPakE0QmdOVkJBTVRNVlZ1YVhabGJuUnAKYjI0Z1EyOXljRzl5WVhSbElGTmxjblpsY2lCU2IyOTBJRU5CSUNoSlJEMXhWMjlZVkRKVFp5a3hIekFkQmdrcQpoa2lHOXcwQkNRRVdFR0ZrYldsdVFHTmhjR1V0YVhRdVpHVXdIaGNOTWpNd01UQXlNVEV3T1RRMVdoY05Namd3Ck1UQXhNVEV3T1RRMVdqQ0JtREVMTUFrR0ExVUVCaE1DUkVVeEN6QUpCZ05WQkFnVEFrUkZNUXN3Q1FZRFZRUUgKRXdKRVJURUxNQWtHQTFVRUNoTUNSRVV4SkRBaUJnTlZCQXNURzFWdWFYWmxiblJwYjI0Z1EyOXljRzl5WVhSbApJRk5sY25abGNqRWJNQmtHQTFVRUF4TVNabXBoWTNGMVpXMXBiaTV2Y0dWdWRuQnVNUjh3SFFZSktvWklodmNOCkFRa0JGaEJoWkcxcGJrQmpZWEJsTFdsMExtUmxNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUIKQ2dLQ0FRRUE5V3d4cHRYeXphaU90TUs4YVF6MUlQb1VNVllRT29wbklLYnl4SkgwdmFiTjEycENQa2RPNGE0awpCVW01VncrZnRVdE5rSW81K0w0N0crRjJFUmNLTkkvUEQreU56QktBWDMwWWJZd1M4U2ZseTBVQVJYMXJ0YmMvCkU5ZFlkaVordTgxR0RiSnNFdGJOdllKSXcvNjdCR1R1VEZ3cE9wQ1dWTXB1eUFZN2NMamMvRGt1cHAxZFcyOWcKWkJnNWZVTjN2SzFqd2JWa3UwZGpKaldVZ3BiMk93WnpwTGhWRGtYeXZnZHJnUU50UllFb04rWktZMzlyZEN6YQo4SWZ1Q3RKeFZUK05tdWNrNzYrQktyR01mSDlVVVBJaytDRGVRTXRaSXo3MFZKeEJnNHhFdUJtY1g4VTM5cTBDClNqcnBrVVZhamtBZm5VZ05VKzF4NzdqM08wd09NUUlEQVFBQm80SUJLakNDQVNZd0NRWURWUjBUQkFJd0FEQWQKQmdOVkhRNEVGZ1FVVjQxczZhV0NzU2lnVkpWOEFnVkFudjU4c0JBd2dld0dBMVVkSXdTQjVEQ0I0WUFVYUJGRwpKMmFTUDB3YWhvUVZqdUVSa0NqbERyV2hnYjJrZ2Jvd2diY3hDekFKQmdOVkJBWVRBa1JGTVFzd0NRWURWUVFJCkV3SkVSVEVMTUFrR0ExVUVCeE1DUkVVeEN6QUpCZ05WQkFvVEFrUkZNU1F3SWdZRFZRUUxFeHRWYm1sMlpXNTAKYVc5dUlFTnZjbkJ2Y21GMFpTQlRaWEoyWlhJeE9qQTRCZ05WQkFNVE1WVnVhWFpsYm5ScGIyNGdRMjl5Y0c5eQpZWFJsSUZObGNuWmxjaUJTYjI5MElFTkJJQ2hKUkQxeFYyOVlWREpUWnlreEh6QWRCZ2txaGtpRzl3MEJDUUVXCkVHRmtiV2x1UUdOaGNHVXRhWFF1WkdXQ0NRQ3kwTExsQ0gvOUF6QUxCZ05WSFE4RUJBTUNCZUF3RFFZSktvWkkKaHZjTkFRRUxCUUFEZ2dFQkFHcDA5ZVpmVkpzSkpjQjl2QTBZSTQ1Yi9CVXZsM3hYVG9DekF5Z2tVLzJMWHZvZApqb00yYWYxYWVJa2w4ODMzSExqY3ltMk1IWDY0T2lOODRKNUk0a2RkdFVDT3RNaSsydEd2cWt4TlVlRWEyMTlKCnlmemx6dmNMNUw4T3BsdVl2d0Z3NUlmV2xVQUpIcnZ6dmdKc21sZmJDNkhWUUMvaVVSaThLMWRDbjNnbVRkbEkKL2pra2pDaGNRODRJOUVKRTZzczFudVBHRVMrNStqLzFuTjh4aXpkT3NkczdKMHNmeTNYWHF5eFlLNWErZitCRgpzQXNNM2p1ZU1oSTJMUTRERXllV1A3alk2Smx0RVFLTDVtUWk4Y3gzQVhNRXZhRVhkcEJFb25vVXhRNFlybGZPCm1RYThRZEZvRFRXNGwvTUIra21YUDZFMHRzZUpIQ0NjNGMzSGV6Yz0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=",
					ContentType => "application/x-x509-ca-cert",
					Filename => "cert.pem",
					Filesize => "5.1 KBytes",
					FilesizeRaw => 5270
				},
				Type => "Cert"
			}
		}
	);
};

When qr/I create a private certificate$/, sub {

	( S->{Response}, S->{ResponseContent} ) = _Post(
		URL     => S->{API_URL}.'/system/certificates',
		Token   => S->{Token},
		Content => {
			Certificate => {
				File => {
					Content => "LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpQcm9jLVR5cGU6IDQsRU5DUllQVEVECkRFSy1JbmZvOiBERVMtRURFMy1DQkMsREIwMTA3ODBGMkFCMTgyOAoKV2J3SGZNQUNUUmU1cGc5K3BtS1ZZb3ZmTGpScWZvbVg3aFRwaTFrL1V2Skt2eXphVzhXT1RkZDlmaGhqcitCZgowL1I1RHJHa0s3VHZObkFqeHJxdTBuUVNmb21ZbE9DNE9JQnBNOFlQSVJOdEF3d3c4WW53aDZYMG5FR3puUnRSCmZ5aVllb2hoY201N0xnVzl0ZlRUUkZjYjBFQmVpdHJyaWgrUEZQVG5qOUlpZTRPcU1seGFjamZnV2orU3EvTjMKVk9ralR5U0RZc0lKRU02Z0I2aUM4NlBGYllsZkUxSzZxNnhhMTBPQ3E2TVd1cGdEN3gzTkFJbjNnMXZLRXpKWApHWTNhbFhuQU0rZERXa0N3VER1Q2lzanRxRVZzTm0zanZidXBzMDVKaGpHK3p5NE9SVGFKS1BHazQyQ0VnSTljCjFycGRTQWo3SnVjcng2MEZNVWhDWWVER01NZTZzelN1TVBsNHJESWdTTXBzM0Fqd21rMTVPeWlYTjRSckkyL0YKYXBoaFpwSlRpVWlpQUFYeC9kMGdkeHorZysvQlRqb0JiWFZYajZ2aGprMnp0L0o3TnBrRDd3YUJTS1dnVmozOAptVmFyZm9vM21acXgvQWUyUldMaUFuOEM5U1k1ZEVtQU1QbzgvUFBiYlNUbmV4S2tscTRhdks1ZWFzMnFvang2CkhSeXdYaC9JbmFXcC9PMzhBQzB5QXJNcTJkRkdJa00vN2lmYXljb2pucFZXQ1dXNHpIZytTOUh2ems1M2MrVDAKbTFxMmg2dHppQk45M3g3Ukx5a08wQVJLc25CMkZFUTNIWG10Umg0UHc1ZjhuNHZYRlBEc3lDZzB3RTVxZzQ1bworY3BiZjJybTZReVJncHR0SzVKUmtKb1gxc0sybjRlLzZHMkRmOUtaYjRWZ213bWJlOCttQUNpVnUwcEVOZHlTCjhVUDlpYlRIWldVWGJvaXJ2dkowQ1JZVXVmODJsSGlidVJDRkl1Wkh2ampHczRJYjZLbzNDZGxmYXFtTlNaM3AKRGVGK3dJU0lKSVo1OEV6YXpFTEZsSFQ3WUxSWnVYN1VYZ3FENGdOOHpmMHFwS1lVZWNudTVtMDNwNXprODdhRgpXbHdLMXRSMldhY2RVOWtvd0FmRW41V0Rla0NOZHFqSmt5MU5XZXlBUkpCc2ZmeG1YcG1SbVNaVnFHU3B5QVZyCnNDYURkdUJud2laSjJwK3AxMzhCNmNzR3o2RlUwRTJuMHhvVk03UERuL210bXNGVHlIaFg0S2Q1UWpVM3owcTAKSFpMR1M1THZwT2Myd2U2OGhHT2NOendSRHV2R2RVQXNHbTdRUFc1YkNpUGZpSEpvQ1RNMDBWbHVQU2pDUzZTWgpJYUlHdG1YSEZSQVVyckR2OVZnVGVmK3BnV3FocHNFZk10ZmtMZGoyMDlsR09WNnFUYlJkV3NNMGt0RDdVV2RXCkxOdDZWcUtrSjd6aUpsbkdmQkh5bTBITlVtVGJGNnRnSmVUZFNqUldrSko3bTlkeE1NdSszazlvNS9SUm9ENXEKSjA4cjZ6b0RVaEl0MUtNUy9EN1ZDbHl4SEd3M3lVVmRadHo3M3o3Y2FJNGhYT1FWNWxNQUNmUHorQmtYSmVtUApIZjhYYUk1Nm5aRmRSSDhRbzZnb1lOOElKbmFtTmVQZE8zN1ltRFZTTnE1NlFCMUFWS0xBeXFQSUljeE5yL0FNClNRWjlXRWsxbHp4SWRQcDdPdnRPL3oxbmUwZEVrL08yNWlnL3dyUDFlOHVZN1JhSjFodkJVR0ZSSXR5Z1U4NW0KWHB1OXBFcVpRdVFhMHlldW9EcFhDUDA0QzNqRUhub1ZaOWtrUnArRW9JMkNSN1VTMStaUTR4R0EyRm9wMk5RWQplTm9aeWI2Z2ZyUVIzaWcwNjdIZkhYYUdqR0dPbjRpaElnMm81Szd0eXZFZDN5VTRWWnBWckN1K1JIMDU2dG92CmtlNVlydGxmNjRJSTBnOFY3V2NXeCswTEVCUDkwZ1J6cnB3N0VwcDIrVUtRYmJFMGNvZ29Sc2VseWRpeEp5Mm8KbkhtdXFBWmw2eHFBc29qNHlUYmZQd0lKR1RGMUlZVE5GMGN1RGl0S1pJajJjaGpTZlJWelBnPT0KLS0tLS1FTkQgUlNBIFBSSVZBVEUgS0VZLS0tLS0K",
					ContentType => "application/x-iwork-keynote-sffkey",
					Filename => "mmustermann.key",
					Filesize => "1.7 KBytes",
					FilesizeRaw => 1743
				},
				Type => "Private",
				Passphrase => "start123"
			}
		}
	);
};






=back

=head1 TERMS AND CONDITIONS

This software is part of the KIX project
(L<https://www.kixdesk.com/>).

This software comes with ABSOLUTELY NO WARRANTY. For details, see the enclosed file
LICENSE-AGPL for license information (AGPL). If you did not receive this file, see

<https://www.gnu.org/licenses/agpl.txt>.

=cut
